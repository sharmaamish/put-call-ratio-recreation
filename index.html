<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NIFTY Put-Call Ratio — Recreated (Responsive)</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body {
      background: #f8f9fa;
    }

    .card {
      border-radius: 12px;
    }

    .small-muted {
      font-size: 0.85rem;
      color: #6c757d;
    }

    /* Make table horizontally scrollable on small screens */
    .table-responsive-sm {
      overflow-x: auto;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">NiftyInvest • PCR (Recreation)</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navMenu">
        <form class="d-flex ms-auto" role="search">
          <input class="form-control me-2" type="search" placeholder="Search stock or index..." aria-label="Search">
          <button class="btn btn-outline-light" type="submit">Search</button>
        </form>
      </div>
    </div>
  </nav>
  <div class="container my-4">
    <div class="row g-3">
      <div class="col-12 col-lg-8">
        <div class="card shadow-sm p-3">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h5 class="mb-0">NIFTY — Put/Call Ratio (PCR)</h5>
              <div class="small-muted">Index: NIFTY • Recreated responsive demo with dummy data</div>
            </div>
            <div class="text-end">
              <div class="h5 mb-0" id="indexValue">25323.55</div>
              <div class="small-muted">178.05 (0.71%)</div>
            </div>
          </div>
          <hr>

          <div class="row g-3">
            <div class="col-12">
              <canvas id="pcrChart" width="600" height="300"></canvas>
            </div>

            <div class="col-12 d-flex gap-2 flex-wrap">
              <div class="btn-group" role="group" aria-label="Timeframe">
                <button class="btn btn-outline-primary active" id="btn50">50 pts</button>
                <button class="btn btn-outline-primary" id="btn30">30 pts</button>
                <button class="btn btn-outline-primary" id="btn10">10 pts</button>
              </div>

              <div class="ms-auto d-flex align-items-center gap-2">
                <label class="mb-0 small-muted">View:</label>
                <select id="viewMode" class="form-select form-select-sm w-auto">
                  <option value="line">Line</option>
                  <option value="bar">Bar</option>
                </select>
              </div>
            </div>
          </div>

        </div>

        <div class="card shadow-sm p-3 mt-3">
          <h6 class="mb-3">Put / Call Sample Table (50 rows)</h6>
          <div class="table-responsive-sm">
            <table class="table table-striped table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th>#</th>
                  <th>Date</th>
                  <th>Strike</th>
                  <th>Calls OI</th>
                  <th>Puts OI</th>
                  <th>PCR (Puts/Calls)</th>
                </tr>
              </thead>
              <tbody id="pcrTableBody"></tbody>
            </table>
          </div>
        </div>

      </div>

      <div class="col-12 col-lg-4">
        <div class="card shadow-sm p-3 mb-3">
          <h6>Quick Stats</h6>
          <ul class="list-unstyled small-muted mb-0">
            <li>Latest PCR: <strong id="latestPCR">0.95</strong></li>
            <li>Average (50): <strong id="avgPCR">0.92</strong></li>
            <li>Max (50): <strong id="maxPCR">1.15</strong></li>
            <li>Min (50): <strong id="minPCR">0.70</strong></li>
          </ul>
        </div>

        <div class="card shadow-sm p-3 mb-3">
          <h6>Related Pages</h6>
          <div class="list-group list-group-flush">
            <a href="#" class="list-group-item list-group-item-action">Option Chain</a>
            <a href="#" class="list-group-item list-group-item-action">Max-pain</a>
            <a href="#" class="list-group-item list-group-item-action">OI Percentile</a>
            <a href="#" class="list-group-item list-group-item-action">Technical</a>
          </div>
        </div>

        <div class="card shadow-sm p-3">
          <h6>Notes</h6>
          <p class="small-muted mb-0">This is a static recreation for demo purposes. Data below uses generated dummy
            points to mimic PCR behavior and is not real market data.</p>
        </div>
      </div>

    </div>
    <footer class="mt-4 text-center small-muted">Recreated page • Bootstrap 5 • Chart.js • Responsive layout</footer>
  </div><!-- Bootstrap Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Generate 50 dummy dates and PCR values
    function generateDummyData(n = 50) {
      const labels = [];
      const pcr = [];
      const calls = [];
      const puts = [];
      const today = new Date();
      for (let i = n - 1; i >= 0; i--) {
        const d = new Date(today);
        d.setDate(today.getDate() - i);
        labels.push(d.toISOString().split('T')[0]);
        // generate calls and puts to create a realistic PCR
        const call = Math.round(800000 + Math.random() * 200000 * (1 + Math.sin(i / 6)));
        const put = Math.round(call * (0.7 + Math.random() * 0.6));
        calls.push(call);
        puts.push(put);
        pcr.push(Number((put / call).toFixed(2)));
      }
      return { labels, pcr, calls, puts };
    }

    let fullData = generateDummyData(50);
    let currentCount = 50;
    let chartType = 'line';

    // Create chart
    const ctx = document.getElementById('pcrChart').getContext('2d');
    let pcrChart = new Chart(ctx, {
      type: chartType,
      data: {
        labels: fullData.labels.slice(-currentCount),
        datasets: [{
          label: 'PCR (Puts / Calls)',
          data: fullData.pcr.slice(-currentCount),
          tension: 0.3,
          borderWidth: 2,
          pointRadius: 3,
          backgroundColor: 'rgba(13,110,253,0.08)',
          borderColor: 'rgba(13,110,253,1)'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: true }
        },
        plugins: {
          tooltip: { mode: 'index', intersect: false }
        }
      }
    });

    function updateChart(count) {
      const labels = fullData.labels.slice(-count);
      const data = fullData.pcr.slice(-count);
      pcrChart.data.labels = labels;
      pcrChart.data.datasets[0].data = data;
      pcrChart.update();
      updateTable(count);
      updateStats(data);
    }

    function updateStats(arr) {
      const latest = arr[arr.length - 1] ?? 0;
      const avg = (arr.reduce((a, b) => a + b, 0) / arr.length) || 0;
      const max = Math.max(...arr);
      const min = Math.min(...arr);
      document.getElementById('latestPCR').innerText = latest.toFixed(2);
      document.getElementById('avgPCR').innerText = avg.toFixed(2);
      document.getElementById('maxPCR').innerText = max.toFixed(2);
      document.getElementById('minPCR').innerText = min.toFixed(2);
    }

    function updateTable(count) {
      const tbody = document.getElementById('pcrTableBody');
      tbody.innerHTML = '';
      const labels = fullData.labels.slice(-count);
      const calls = fullData.calls.slice(-count);
      const puts = fullData.puts.slice(-count);
      const pcr = fullData.pcr.slice(-count);
      for (let i = 0; i < labels.length; i++) {
        const tr = document.createElement('tr');
        tr.innerHTML = <td>${i+1}</td><td>${labels[i]}</td><td>—</td><td>${calls[i].toLocaleString()}</td><td>${puts[i].toLocaleString()}</td><td>${pcr[i].toFixed(2)}</td>;
        tbody.appendChild(tr);
      }
    }

    // Buttons
    document.getElementById('btn50').addEventListener('click', () => { currentCount = 50; setActiveBtn('btn50'); updateChart(currentCount); });
    document.getElementById('btn30').addEventListener('click', () => { currentCount = 30; setActiveBtn('btn30'); updateChart(currentCount); });
    document.getElementById('btn10').addEventListener('click', () => { currentCount = 10; setActiveBtn('btn10'); updateChart(currentCount); });

    function setActiveBtn(id) { ['btn50', 'btn30', 'btn10'].forEach(b => document.getElementById(b).classList.remove('active')); document.getElementById(id).classList.add('active'); }

    // View mode change
    document.getElementById('viewMode').addEventListener('change', (e) => {
      const mode = e.target.value;
      pcrChart.destroy();
      pcrChart = new Chart(ctx, {
        type: mode,
        data: {
          labels: fullData.labels.slice(-currentCount),
          datasets: [{
            label: 'PCR (Puts / Calls)',
            data: fullData.pcr.slice(-currentCount),
            borderWidth: 2,
            backgroundColor: 'rgba(13,110,253,0.12)',
            borderColor: 'rgba(13,110,253,1)'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: { y: { beginAtZero: true } },
          plugins: { tooltip: { mode: 'index', intersect: false } }
        }
      });
    });

    // Init
    updateChart(currentCount);

  </script>
</body>

</html>
